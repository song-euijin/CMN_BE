<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cmn.service.impl.UserMapper">

	<resultMap id="UserResultMap" type="com.cmn.service.UserVO">
		<result property="userId" 				column="USER_ID"/>
		<result property="userPw" 				column="USER_PW"/>
		<result property="userFirstName" 		column="USER_FIRST_NAME"/>
		<result property="userLastName" 		column="USER_LAST_NAME"/>
		<result property="userDept" 			column="FK_COMMON_CODE_DEPT"/>
		<result property="userRank" 			column="FK_COMMON_CODE_RANK"/>
		<result property="userPosition" 		column="FK_COMMON_CODE_POSITION"/>
		<result property="userAuthority" 		column="FK_COMMON_CODE_AUTHORITY"/>
		<result property="userStatus" 			column="FK_COMMON_CODE_STATUS"/>
		<result property="userPhone" 			column="USER_PHONE"/>
		<result property="userLandLineNumber" 	column="USER_LANDLINE_NUMBER"/>
		<result property="userZipCode"			column="USER_ZIP_CODE"/>
		<result property="userAddr"				column="USER_ADDR"/>
		<result property="userAddrDetail"		column="USER_ADDR_DETAIL"/>
		<result property="userName"				column="USER_NAME"/>
		<result property="userImg"				column="USER_IMG"/>
	</resultMap>
	
	<resultMap id="ModifyResultMap" type="com.cmn.service.ModifyVO">
		<result property="userId" 				column="USER_ID"/>
		<result property="userImg" 				column="USER_IMG"/>
		<result property="userDept" 			column="FK_COMMON_CODE_DEPT"/>
		<result property="userRank" 			column="FK_COMMON_CODE_RANK"/>
		<result property="userPosition" 		column="FK_COMMON_CODE_POSITION"/>
		<result property="userAuthority" 		column="FK_COMMON_CODE_AUTHORITY"/>
		<result property="userStatus" 			column="FK_COMMON_CODE_STATUS"/>
	</resultMap>
	
	<resultMap id="CodeResultMap" type="com.cmn.service.CodeVO">
		<result property="commonCode" 			column="COMMON_CODE"/>
		<result property="upperCommonCode" 		column="UPPER_COMMON_CODE"/>
		<result property="codeName" 			column="CODE_NAME"/>
		<result property="codeDescription" 		column="CODE_DESCRIPTION"/>
	</resultMap>

	<resultMap id="CompanyResultMap" type="com.cmn.service.CompanyVO">
		<result property="companyCode" 			column="COMPANY_CODE"/>
		<result property="companyName" 			column="COMPANY_NAME"/>
		<result property="companyDomain" 		column="COMPANY_DOMAIN"/>
	</resultMap>

	<select id="getUserList" resultMap="UserResultMap" >
		-- 사용자 조회
		SELECT
			u.USER_ID,
			u.USER_NAME,
			u.USER_PHONE,
			cd.CODE_NAME FK_COMMON_CODE_DEPT,
			cr.CODE_NAME FK_COMMON_CODE_RANK,
			cp.CODE_NAME FK_COMMON_CODE_POSITION,
			ca.CODE_NAME FK_COMMON_CODE_AUTHORITY,
			cs.CODE_NAME FK_COMMON_CODE_STATUS
		FROM
			TB_USER u
		JOIN TB_COMMON_CODE cd
		ON u.FK_COMMON_CODE_DEPT = cd.COMMON_CODE
		JOIN TB_COMMON_CODE cr
		ON u.FK_COMMON_CODE_RANK = cr.COMMON_CODE
		JOIN TB_COMMON_CODE cp
		ON u.FK_COMMON_CODE_POSITION = cp.COMMON_CODE
		JOIN TB_COMMON_CODE ca
		ON u.FK_COMMON_CODE_AUTHORITY = ca.COMMON_CODE
		JOIN TB_COMMON_CODE cs
		ON u.FK_COMMON_CODE_STATUS = cs.COMMON_CODE
		ORDER BY USER_NAME
	</select>

	<select id="getSearchUserList" resultMap="UserResultMap">
		-- 사용자 목록 검색
		SELECT
			u.USER_ID,
			u.USER_NAME,
			u.USER_PHONE,
			cd.CODE_NAME FK_COMMON_CODE_DEPT,
			cr.CODE_NAME FK_COMMON_CODE_RANK,
			cp.CODE_NAME FK_COMMON_CODE_POSITION,
			ca.CODE_NAME FK_COMMON_CODE_AUTHORITY,
			cs.CODE_NAME FK_COMMON_CODE_STATUS
		FROM
			TB_USER u
		JOIN TB_COMMON_CODE cd
		ON u.FK_COMMON_CODE_DEPT = cd.COMMON_CODE
		JOIN TB_COMMON_CODE cr
		ON u.FK_COMMON_CODE_RANK = cr.COMMON_CODE
		JOIN TB_COMMON_CODE cp
		ON u.FK_COMMON_CODE_POSITION = cp.COMMON_CODE
		JOIN TB_COMMON_CODE ca
		ON u.FK_COMMON_CODE_AUTHORITY = ca.COMMON_CODE
		JOIN TB_COMMON_CODE cs
		ON u.FK_COMMON_CODE_STATUS = cs.COMMON_CODE
		WHERE ${searchKey} LIKE '%' || #{searchValue} || '%'
		ORDER BY USER_NAME
	</select>

	<select id="getDeptList" resultMap="CodeResultMap" >
		-- 부서 조회
		SELECT
		    COMMON_CODE,
		    CODE_NAME
		FROM
		    TB_COMMON_CODE
		WHERE
		    UPPER_COMMON_CODE = 'D00'
	</select>
	
	<select id="getRankList" resultMap="CodeResultMap" >
		-- 직급 조회
		SELECT
		    COMMON_CODE,
		    CODE_NAME
		FROM
		    TB_COMMON_CODE
		WHERE
		    UPPER_COMMON_CODE = 'R00'
	</select>
	
	<select id="getPositionList" resultMap="CodeResultMap" >
		-- 직책 조회
		SELECT
		    COMMON_CODE,
		    CODE_NAME
		FROM
		    TB_COMMON_CODE
		WHERE
		    UPPER_COMMON_CODE = 'P00'
	</select>
	
	<select id="getAuthorityList" resultMap="CodeResultMap" >
		-- 권한 조회
		SELECT
		    COMMON_CODE,
		    CODE_NAME
		FROM
		    TB_COMMON_CODE
		WHERE
		    UPPER_COMMON_CODE = 'A00'
	</select>
	
	<select id="getStatusList" resultMap="CodeResultMap" >
		-- 상태 조회
		SELECT
		    COMMON_CODE,
		    CODE_NAME
		FROM
		    TB_COMMON_CODE
		WHERE
		    UPPER_COMMON_CODE = 'S00'
	</select>
	
	<select id="getCompanyInfo" resultMap="CompanyResultMap" >
		-- 회사정보 조회
		SELECT
			COMPANY_CODE,
		    COMPANY_NAME,
		    COMPANY_DOMAIN
		FROM
		    TB_COMPANY
	</select>
	
	<select id="idDupleCheck" parameterType="String" resultType="Integer">
		-- 아이디 중복검사 ajax
		SELECT COUNT(*) result
		FROM TB_USER
		WHERE USER_ID = #{userId}	
	</select>
	
	<insert id="userReg">
		-- 사용자 등록
		INSERT INTO TB_USER(
		    USER_ID,
		    USER_PW,
		    USER_FIRST_NAME,
		    USER_LAST_NAME,
		    USER_NAME,
		    USER_IMG,
		    FK_COMMON_CODE_DEPT,
		    FK_COMMON_CODE_RANK,
		    FK_COMMON_CODE_POSITION,
		    FK_COMMON_CODE_AUTHORITY,
		    FK_COMMON_CODE_STATUS,
		    USER_PHONE,
		    USER_LANDLINE_NUMBER,
		    USER_ZIP_CODE,
		    USER_ADDR,
		    USER_ADDR_DETAIL,
		    USER_REG_DATE
		)VALUES(
		    #{userId},
		    #{userPw},
		    #{userFirstName},
		    #{userLastName},
		    #{userFirstName} || #{userLastName},
		    #{userImg},
		    #{userDept},
		    #{userRank},
		    #{userPosition},
		    #{userAuthority},
		    'S0000',
		    #{userPhone},
		    #{userLandLineNumber},
		    #{userZipCode},
		    #{userAddr},
		    #{userAddrDetail},
		    TRUNC(SYSDATE)
		)
	</insert>
	
	<select id="getUserInfo" resultMap="UserResultMap" >
		-- 사용자 정보 페이지 조회
		SELECT
			u.USER_NAME,
			u.USER_ID,
			u.USER_IMG,
			cd.CODE_NAME FK_COMMON_CODE_DEPT,
			cr.CODE_NAME FK_COMMON_CODE_RANK,
			cp.CODE_NAME FK_COMMON_CODE_POSITION,
			ca.CODE_NAME FK_COMMON_CODE_AUTHORITY,
			cs.CODE_NAME FK_COMMON_CODE_STATUS,
			u.USER_PHONE,
			u.USER_LANDLINE_NUMBER,
			u.USER_ADDR,
			u.USER_ADDR_DETAIL
		FROM
			TB_USER u
		JOIN TB_COMMON_CODE cd
		ON u.FK_COMMON_CODE_DEPT = cd.COMMON_CODE
		JOIN TB_COMMON_CODE cr
		ON u.FK_COMMON_CODE_RANK = cr.COMMON_CODE
		JOIN TB_COMMON_CODE cp
		ON u.FK_COMMON_CODE_POSITION = cp.COMMON_CODE
		JOIN TB_COMMON_CODE ca
		ON u.FK_COMMON_CODE_AUTHORITY = ca.COMMON_CODE
		JOIN TB_COMMON_CODE cs
		ON u.FK_COMMON_CODE_STATUS = cs.COMMON_CODE
	    WHERE USER_ID = #{userId}
	</select>
	
	<select id="getTargetCodeInfo" resultMap="UserResultMap" >
		-- 사용자 코드 정보 조회
		SELECT
			USER_ID,
			FK_COMMON_CODE_DEPT,
			FK_COMMON_CODE_RANK,
			FK_COMMON_CODE_POSITION,
			FK_COMMON_CODE_AUTHORITY,
			FK_COMMON_CODE_STATUS
		FROM
			TB_USER
	    WHERE USER_ID = #{userId}
	</select>
	
	<update id="userModify">
		-- 사용자 수정
		UPDATE TB_USER
		SET 
			USER_IMG = #{userImg},
		    FK_COMMON_CODE_DEPT = #{userDept},
		    FK_COMMON_CODE_RANK = #{userRank},
		    FK_COMMON_CODE_POSITION = #{userPosition},
		    FK_COMMON_CODE_AUTHORITY = #{userAuthority},
		    FK_COMMON_CODE_STATUS = #{userStatus},
		    USER_MODIFY_DATE = TRUNC(SYSDATE)
		WHERE 
			USER_ID = #{userId}
	</update>
	
	<delete id="userDelete">
		-- 사용자 삭제
		DELETE FROM TB_USER WHERE USER_ID = #{userId}
	</delete>
	
</mapper>	 